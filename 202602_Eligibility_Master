-- ====================================================================
-- PHASE 1: CREATE CLEAN VIEWS (DEDUPLICATED)
-- ====================================================================

-- 1. SCL (Single Credit Life)
CREATE OR REPLACE TEMP VIEW view_SCL_flags AS
WITH Unique_SCL AS (
    SELECT uai_id, score_branch_no, SALE_CT, CANCEL_CT
    FROM core.optional_product_sale
    WHERE coverage_abbreviation_cd = 'SCL' AND LOAN_ELIGIBLE = 'Y'
    QUALIFY ROW_NUMBER() OVER (PARTITION BY uai_id, score_branch_no ORDER BY SALE_CT DESC, CANCEL_CT DESC, RECORD_UPDATE_TS DESC) = 1
)
SELECT 
    uai_id, score_branch_no,
    1 AS IS_SCL_ELIGIBLE,
    CASE WHEN SALE_CT > 0 THEN 1 ELSE 0 END AS IS_SCL_GROSS_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) = 0 THEN 1 ELSE 0 END AS IS_SCL_NET_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN 1 ELSE 0 END AS IS_SCL_CANCELED,
    CASE 
        WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN '4. Sold - Canceled'
        WHEN SALE_CT > 0 THEN '3. Sold - Active'
        ELSE '2. Eligible - Waived'
    END AS SCL_LIFECYCLE_STATUS
FROM Unique_SCL;

-- 2. SCA (Single Credit Accident)
CREATE OR REPLACE TEMP VIEW view_SCA_flags AS
WITH Unique_SCA AS (
    SELECT uai_id, score_branch_no, SALE_CT, CANCEL_CT
    FROM core.optional_product_sale
    WHERE coverage_abbreviation_cd = 'SCA' AND LOAN_ELIGIBLE = 'Y'
    QUALIFY ROW_NUMBER() OVER (PARTITION BY uai_id, score_branch_no ORDER BY SALE_CT DESC, CANCEL_CT DESC, RECORD_UPDATE_TS DESC) = 1
)
SELECT 
    uai_id, score_branch_no,
    1 AS IS_SCA_ELIGIBLE,
    CASE WHEN SALE_CT > 0 THEN 1 ELSE 0 END AS IS_SCA_GROSS_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) = 0 THEN 1 ELSE 0 END AS IS_SCA_NET_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN 1 ELSE 0 END AS IS_SCA_CANCELED,
    CASE 
        WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN '4. Sold - Canceled'
        WHEN SALE_CT > 0 THEN '3. Sold - Active'
        ELSE '2. Eligible - Waived'
    END AS SCA_LIFECYCLE_STATUS
FROM Unique_SCA;

-- 3. IUI (Involuntary Unemployment)
CREATE OR REPLACE TEMP VIEW view_IUI_flags AS
WITH Unique_IUI AS (
    SELECT uai_id, score_branch_no, SALE_CT, CANCEL_CT
    FROM core.optional_product_sale
    WHERE coverage_abbreviation_cd = 'IUI' AND LOAN_ELIGIBLE = 'Y'
    QUALIFY ROW_NUMBER() OVER (PARTITION BY uai_id, score_branch_no ORDER BY SALE_CT DESC, CANCEL_CT DESC, RECORD_UPDATE_TS DESC) = 1
)
SELECT 
    uai_id, score_branch_no,
    1 AS IS_IUI_ELIGIBLE,
    CASE WHEN SALE_CT > 0 THEN 1 ELSE 0 END AS IS_IUI_GROSS_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) = 0 THEN 1 ELSE 0 END AS IS_IUI_NET_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN 1 ELSE 0 END AS IS_IUI_CANCELED,
    CASE 
        WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN '4. Sold - Canceled'
        WHEN SALE_CT > 0 THEN '3. Sold - Active'
        ELSE '2. Eligible - Waived'
    END AS IUI_LIFECYCLE_STATUS
FROM Unique_IUI;

-- 4. GAP (Guaranteed Asset Protection)
CREATE OR REPLACE TEMP VIEW view_GAP_flags AS
WITH Unique_GAP AS (
    SELECT uai_id, score_branch_no, SALE_CT, CANCEL_CT
    FROM core.optional_product_sale
    WHERE coverage_abbreviation_cd = 'GAP' AND LOAN_ELIGIBLE = 'Y'
    QUALIFY ROW_NUMBER() OVER (PARTITION BY uai_id, score_branch_no ORDER BY SALE_CT DESC, CANCEL_CT DESC, RECORD_UPDATE_TS DESC) = 1
)
SELECT 
    uai_id, score_branch_no,
    1 AS IS_GAP_ELIGIBLE,
    CASE WHEN SALE_CT > 0 THEN 1 ELSE 0 END AS IS_GAP_GROSS_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) = 0 THEN 1 ELSE 0 END AS IS_GAP_NET_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN 1 ELSE 0 END AS IS_GAP_CANCELED,
    CASE 
        WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN '4. Sold - Canceled'
        WHEN SALE_CT > 0 THEN '3. Sold - Active'
        ELSE '2. Eligible - Waived'
    END AS GAP_LIFECYCLE_STATUS
FROM Unique_GAP;

-- 5. AUT (Auto / Vehicle Service Contract)
CREATE OR REPLACE TEMP VIEW view_AUT_flags AS
WITH Unique_AUT AS (
    SELECT uai_id, score_branch_no, SALE_CT, CANCEL_CT
    FROM core.optional_product_sale
    WHERE coverage_abbreviation_cd = 'AUT' AND LOAN_ELIGIBLE = 'Y'
    QUALIFY ROW_NUMBER() OVER (PARTITION BY uai_id, score_branch_no ORDER BY SALE_CT DESC, CANCEL_CT DESC, RECORD_UPDATE_TS DESC) = 1
)
SELECT 
    uai_id, score_branch_no,
    1 AS IS_AUT_ELIGIBLE,
    CASE WHEN SALE_CT > 0 THEN 1 ELSE 0 END AS IS_AUT_GROSS_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) = 0 THEN 1 ELSE 0 END AS IS_AUT_NET_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN 1 ELSE 0 END AS IS_AUT_CANCELED,
    CASE 
        WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN '4. Sold - Canceled'
        WHEN SALE_CT > 0 THEN '3. Sold - Active'
        ELSE '2. Eligible - Waived'
    END AS AUT_LIFECYCLE_STATUS
FROM Unique_AUT;

-- 6. HA (Hospital Accident)
CREATE OR REPLACE TEMP VIEW view_HA_flags AS
WITH Unique_HA AS (
    SELECT uai_id, score_branch_no, SALE_CT, CANCEL_CT
    FROM core.optional_product_sale
    WHERE coverage_abbreviation_cd = 'HA' AND LOAN_ELIGIBLE = 'Y'
    QUALIFY ROW_NUMBER() OVER (PARTITION BY uai_id, score_branch_no ORDER BY SALE_CT DESC, CANCEL_CT DESC, RECORD_UPDATE_TS DESC) = 1
)
SELECT 
    uai_id, score_branch_no,
    1 AS IS_HA_ELIGIBLE,
    CASE WHEN SALE_CT > 0 THEN 1 ELSE 0 END AS IS_HA_GROSS_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) = 0 THEN 1 ELSE 0 END AS IS_HA_NET_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN 1 ELSE 0 END AS IS_HA_CANCELED,
    CASE 
        WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN '4. Sold - Canceled'
        WHEN SALE_CT > 0 THEN '3. Sold - Active'
        ELSE '2. Eligible - Waived'
    END AS HA_LIFECYCLE_STATUS
FROM Unique_HA;

-- 7. ATL (Auto Term Life)
CREATE OR REPLACE TEMP VIEW view_ATL_flags AS
WITH Unique_ATL AS (
    SELECT uai_id, score_branch_no, SALE_CT, CANCEL_CT
    FROM core.optional_product_sale
    WHERE coverage_abbreviation_cd = 'ATL' AND LOAN_ELIGIBLE = 'Y'
    QUALIFY ROW_NUMBER() OVER (PARTITION BY uai_id, score_branch_no ORDER BY SALE_CT DESC, CANCEL_CT DESC, RECORD_UPDATE_TS DESC) = 1
)
SELECT 
    uai_id, score_branch_no,
    1 AS IS_ATL_ELIGIBLE,
    CASE WHEN SALE_CT > 0 THEN 1 ELSE 0 END AS IS_ATL_GROSS_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) = 0 THEN 1 ELSE 0 END AS IS_ATL_NET_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN 1 ELSE 0 END AS IS_ATL_CANCELED,
    CASE 
        WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN '4. Sold - Canceled'
        WHEN SALE_CT > 0 THEN '3. Sold - Active'
        ELSE '2. Eligible - Waived'
    END AS ATL_LIFECYCLE_STATUS
FROM Unique_ATL;

-- 8. SSG (Supplemental Security / Other)
CREATE OR REPLACE TEMP VIEW view_SSG_flags AS
WITH Unique_SSG AS (
    SELECT uai_id, score_branch_no, SALE_CT, CANCEL_CT
    FROM core.optional_product_sale
    WHERE coverage_abbreviation_cd = 'SSG' AND LOAN_ELIGIBLE = 'Y'
    QUALIFY ROW_NUMBER() OVER (PARTITION BY uai_id, score_branch_no ORDER BY SALE_CT DESC, CANCEL_CT DESC, RECORD_UPDATE_TS DESC) = 1
)
SELECT 
    uai_id, score_branch_no,
    1 AS IS_SSG_ELIGIBLE,
    CASE WHEN SALE_CT > 0 THEN 1 ELSE 0 END AS IS_SSG_GROSS_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) = 0 THEN 1 ELSE 0 END AS IS_SSG_NET_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN 1 ELSE 0 END AS IS_SSG_CANCELED,
    CASE 
        WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN '4. Sold - Canceled'
        WHEN SALE_CT > 0 THEN '3. Sold - Active'
        ELSE '2. Eligible - Waived'
    END AS SSG_LIFECYCLE_STATUS
FROM Unique_SSG;

-- 9. DIP (Disability Income Plus)
CREATE OR REPLACE TEMP VIEW view_DIP_flags AS
WITH Unique_DIP AS (
    SELECT uai_id, score_branch_no, SALE_CT, CANCEL_CT
    FROM core.optional_product_sale
    WHERE coverage_abbreviation_cd = 'DIP' AND LOAN_ELIGIBLE = 'Y'
    QUALIFY ROW_NUMBER() OVER (PARTITION BY uai_id, score_branch_no ORDER BY SALE_CT DESC, CANCEL_CT DESC, RECORD_UPDATE_TS DESC) = 1
)
SELECT 
    uai_id, score_branch_no,
    1 AS IS_DIP_ELIGIBLE,
    CASE WHEN SALE_CT > 0 THEN 1 ELSE 0 END AS IS_DIP_GROSS_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) = 0 THEN 1 ELSE 0 END AS IS_DIP_NET_SOLD,
    CASE WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN 1 ELSE 0 END AS IS_DIP_CANCELED,
    CASE 
        WHEN SALE_CT > 0 AND COALESCE(CANCEL_CT, 0) > 0 THEN '4. Sold - Canceled'
        WHEN SALE_CT > 0 THEN '3. Sold - Active'
        ELSE '2. Eligible - Waived'
    END AS DIP_LIFECYCLE_STATUS
FROM Unique_DIP;


-- ====================================================================
-- PHASE 2: FINAL MASTER JOIN
-- ====================================================================

CREATE OR REPLACE TEMP TABLE optional_product_master AS
SELECT 
    A.*, 
    
    -- 1. SCL
    COALESCE(SCL.IS_SCL_ELIGIBLE, 0)   AS IS_SCL_ELIGIBLE,
    COALESCE(SCL.IS_SCL_GROSS_SOLD, 0) AS IS_SCL_GROSS_SOLD,
    COALESCE(SCL.IS_SCL_NET_SOLD, 0)   AS IS_SCL_NET_SOLD,
    COALESCE(SCL.IS_SCL_CANCELED, 0)   AS IS_SCL_CANCELED,
    COALESCE(SCL.SCL_LIFECYCLE_STATUS, '1. Not Eligible') AS SCL_LIFECYCLE_STATUS,

    -- 2. SCA
    COALESCE(SCA.IS_SCA_ELIGIBLE, 0)   AS IS_SCA_ELIGIBLE,
    COALESCE(SCA.IS_SCA_GROSS_SOLD, 0) AS IS_SCA_GROSS_SOLD,
    COALESCE(SCA.IS_SCA_NET_SOLD, 0)   AS IS_SCA_NET_SOLD,
    COALESCE(SCA.IS_SCA_CANCELED, 0)   AS IS_SCA_CANCELED,
    COALESCE(SCA.SCA_LIFECYCLE_STATUS, '1. Not Eligible') AS SCA_LIFECYCLE_STATUS,

    -- 3. IUI
    COALESCE(IUI.IS_IUI_ELIGIBLE, 0)   AS IS_IUI_ELIGIBLE,
    COALESCE(IUI.IS_IUI_GROSS_SOLD, 0) AS IS_IUI_GROSS_SOLD,
    COALESCE(IUI.IS_IUI_NET_SOLD, 0)   AS IS_IUI_NET_SOLD,
    COALESCE(IUI.IS_IUI_CANCELED, 0)   AS IS_IUI_CANCELED,
    COALESCE(IUI.IUI_LIFECYCLE_STATUS, '1. Not Eligible') AS IUI_LIFECYCLE_STATUS,

    -- 4. GAP
    COALESCE(GAP.IS_GAP_ELIGIBLE, 0)   AS IS_GAP_ELIGIBLE,
    COALESCE(GAP.IS_GAP_GROSS_SOLD, 0) AS IS_GAP_GROSS_SOLD,
    COALESCE(GAP.IS_GAP_NET_SOLD, 0)   AS IS_GAP_NET_SOLD,
    COALESCE(GAP.IS_GAP_CANCELED, 0)   AS IS_GAP_CANCELED,
    COALESCE(GAP.GAP_LIFECYCLE_STATUS, '1. Not Eligible') AS GAP_LIFECYCLE_STATUS,

    -- 5. AUT
    COALESCE(AUT.IS_AUT_ELIGIBLE, 0)   AS IS_AUT_ELIGIBLE,
    COALESCE(AUT.IS_AUT_GROSS_SOLD, 0) AS IS_AUT_GROSS_SOLD,
    COALESCE(AUT.IS_AUT_NET_SOLD, 0)   AS IS_AUT_NET_SOLD,
    COALESCE(AUT.IS_AUT_CANCELED, 0)   AS IS_AUT_CANCELED,
    COALESCE(AUT.AUT_LIFECYCLE_STATUS, '1. Not Eligible') AS AUT_LIFECYCLE_STATUS,

    -- 6. HA
    COALESCE(HA.IS_HA_ELIGIBLE, 0)   AS IS_HA_ELIGIBLE,
    COALESCE(HA.IS_HA_GROSS_SOLD, 0) AS IS_HA_GROSS_SOLD,
    COALESCE(HA.IS_HA_NET_SOLD, 0)   AS IS_HA_NET_SOLD,
    COALESCE(HA.IS_HA_CANCELED, 0)   AS IS_HA_CANCELED,
    COALESCE(HA.HA_LIFECYCLE_STATUS, '1. Not Eligible') AS HA_LIFECYCLE_STATUS,

    -- 7. ATL
    COALESCE(ATL.IS_ATL_ELIGIBLE, 0)   AS IS_ATL_ELIGIBLE,
    COALESCE(ATL.IS_ATL_GROSS_SOLD, 0) AS IS_ATL_GROSS_SOLD,
    COALESCE(ATL.IS_ATL_NET_SOLD, 0)   AS IS_ATL_NET_SOLD,
    COALESCE(ATL.IS_ATL_CANCELED, 0)   AS IS_ATL_CANCELED,
    COALESCE(ATL.ATL_LIFECYCLE_STATUS, '1. Not Eligible') AS ATL_LIFECYCLE_STATUS,

    -- 8. SSG
    COALESCE(SSG.IS_SSG_ELIGIBLE, 0)   AS IS_SSG_ELIGIBLE,
    COALESCE(SSG.IS_SSG_GROSS_SOLD, 0) AS IS_SSG_GROSS_SOLD,
    COALESCE(SSG.IS_SSG_NET_SOLD, 0)   AS IS_SSG_NET_SOLD,
    COALESCE(SSG.IS_SSG_CANCELED, 0)   AS IS_SSG_CANCELED,
    COALESCE(SSG.SSG_LIFECYCLE_STATUS, '1. Not Eligible') AS SSG_LIFECYCLE_STATUS,

    -- 9. DIP
    COALESCE(DIP.IS_DIP_ELIGIBLE, 0)   AS IS_DIP_ELIGIBLE,
    COALESCE(DIP.IS_DIP_GROSS_SOLD, 0) AS IS_DIP_GROSS_SOLD,
    COALESCE(DIP.IS_DIP_NET_SOLD, 0)   AS IS_DIP_NET_SOLD,
    COALESCE(DIP.IS_DIP_CANCELED, 0)   AS IS_DIP_CANCELED,
    COALESCE(DIP.DIP_LIFECYCLE_STATUS, '1. Not Eligible') AS DIP_LIFECYCLE_STATUS

FROM 
    bdm.app_loan_production A

    -- Join 1: SCL
    LEFT JOIN view_SCL_flags SCL 
        ON A.uai_id = SCL.uai_id AND CAST(A.own_score_brnch AS INT) = CAST(SCL.score_branch_no AS INT)

    -- Join 2: SCA
    LEFT JOIN view_SCA_flags SCA 
        ON A.uai_id = SCA.uai_id AND CAST(A.own_score_brnch AS INT) = CAST(SCA.score_branch_no AS INT)

    -- Join 3: IUI
    LEFT JOIN view_IUI_flags IUI 
        ON A.uai_id = IUI.uai_id AND CAST(A.own_score_brnch AS INT) = CAST(IUI.score_branch_no AS INT)

    -- Join 4: GAP
    LEFT JOIN view_GAP_flags GAP 
        ON A.uai_id = GAP.uai_id AND CAST(A.own_score_brnch AS INT) = CAST(GAP.score_branch_no AS INT)

    -- Join 5: AUT
    LEFT JOIN view_AUT_flags AUT 
        ON A.uai_id = AUT.uai_id AND CAST(A.own_score_brnch AS INT) = CAST(AUT.score_branch_no AS INT)

    -- Join 6: HA
    LEFT JOIN view_HA_flags HA 
        ON A.uai_id = HA.uai_id AND CAST(A.own_score_brnch AS INT) = CAST(HA.score_branch_no AS INT)

    -- Join 7: ATL
    LEFT JOIN view_ATL_flags ATL 
        ON A.uai_id = ATL.uai_id AND CAST(A.own_score_brnch AS INT) = CAST(ATL.score_branch_no AS INT)

    -- Join 8: SSG
    LEFT JOIN view_SSG_flags SSG 
        ON A.uai_id = SSG.uai_id AND CAST(A.own_score_brnch AS INT) = CAST(SSG.score_branch_no AS INT)

    -- Join 9: DIP
    LEFT JOIN view_DIP_flags DIP 
        ON A.uai_id = DIP.uai_id AND CAST(A.own_score_brnch AS INT) = CAST(DIP.score_branch_no AS INT)

WHERE 
    A.CORE_V_CAPP = 'Core'
    AND A.APPL_STAT = 'BOOK'
    AND A.APPROVED_FLAG = 'Y'
    AND A.contr_date BETWEEN '2025-01-01' AND '2025-12-31';

SELECT 
    COUNT(*) AS total_booked_loans,
    
    -- 1. SCL (Single Credit Life)
    SUM(IS_SCL_ELIGIBLE)   AS scl_eligible,
    SUM(IS_SCL_GROSS_SOLD) AS scl_sold_gross,
    SUM(IS_SCL_CANCELED)   AS scl_canceled,
    SUM(IS_SCL_NET_SOLD)   AS scl_sold_net,

    -- 2. SCA (Single Credit Accident)
    SUM(IS_SCA_ELIGIBLE)   AS sca_eligible,
    SUM(IS_SCA_GROSS_SOLD) AS sca_sold_gross,
    SUM(IS_SCA_CANCELED)   AS sca_canceled,
    SUM(IS_SCA_NET_SOLD)   AS sca_sold_net,

    -- 3. IUI (Involuntary Unemployment)
    SUM(IS_IUI_ELIGIBLE)   AS iui_eligible,
    SUM(IS_IUI_GROSS_SOLD) AS iui_sold_gross,
    SUM(IS_IUI_CANCELED)   AS iui_canceled,
    SUM(IS_IUI_NET_SOLD)   AS iui_sold_net,

    -- 4. GAP (Guaranteed Asset Protection)
    SUM(IS_GAP_ELIGIBLE)   AS gap_eligible,
    SUM(IS_GAP_GROSS_SOLD) AS gap_sold_gross,
    SUM(IS_GAP_CANCELED)   AS gap_canceled,
    SUM(IS_GAP_NET_SOLD)   AS gap_sold_net,

    -- 5. AUT (Auto / Vehicle Service Contract)
    SUM(IS_AUT_ELIGIBLE)   AS aut_eligible,
    SUM(IS_AUT_GROSS_SOLD) AS aut_sold_gross,
    SUM(IS_AUT_CANCELED)   AS aut_canceled,
    SUM(IS_AUT_NET_SOLD)   AS aut_sold_net,

    -- 6. HA (Hospital Accident)
    SUM(IS_HA_ELIGIBLE)    AS ha_eligible,
    SUM(IS_HA_GROSS_SOLD)  AS ha_sold_gross,
    SUM(IS_HA_CANCELED)    AS ha_canceled,
    SUM(IS_HA_NET_SOLD)    AS ha_sold_net,

    -- 7. ATL (Auto Term Life)
    SUM(IS_ATL_ELIGIBLE)   AS atl_eligible,
    SUM(IS_ATL_GROSS_SOLD) AS atl_sold_gross,
    SUM(IS_ATL_CANCELED)   AS atl_canceled,
    SUM(IS_ATL_NET_SOLD)   AS atl_sold_net,

    -- 8. SSG (Supplemental Security)
    SUM(IS_SSG_ELIGIBLE)   AS ssg_eligible,
    SUM(IS_SSG_GROSS_SOLD) AS ssg_sold_gross,
    SUM(IS_SSG_CANCELED)   AS ssg_canceled,
    SUM(IS_SSG_NET_SOLD)   AS ssg_sold_net,

    -- 9. DIP (Disability Income Plus)
    SUM(IS_DIP_ELIGIBLE)   AS dip_eligible,
    SUM(IS_DIP_GROSS_SOLD) AS dip_sold_gross,
    SUM(IS_DIP_CANCELED)   AS dip_canceled,
    SUM(IS_DIP_NET_SOLD)   AS dip_sold_net

FROM 
    optional_product_master;

SELECT 'SCL' AS Product, COUNT(*) AS Total_Booked_Loans, SUM(IS_SCL_ELIGIBLE) AS Eligible, SUM(IS_SCL_GROSS_SOLD) AS Sold, SUM(IS_SCL_CANCELED) AS Canceled, SUM(IS_SCL_NET_SOLD) AS Net_Sold FROM optional_product_master
UNION ALL
SELECT 'SCA' AS Product, COUNT(*) AS Total_Booked_Loans, SUM(IS_SCA_ELIGIBLE) AS Eligible, SUM(IS_SCA_GROSS_SOLD) AS Sold, SUM(IS_SCA_CANCELED) AS Canceled, SUM(IS_SCA_NET_SOLD) AS Net_Sold FROM optional_product_master
UNION ALL
SELECT 'IUI' AS Product, COUNT(*) AS Total_Booked_Loans, SUM(IS_IUI_ELIGIBLE) AS Eligible, SUM(IS_IUI_GROSS_SOLD) AS Sold, SUM(IS_IUI_CANCELED) AS Canceled, SUM(IS_IUI_NET_SOLD) AS Net_Sold FROM optional_product_master
UNION ALL
SELECT 'GAP' AS Product, COUNT(*) AS Total_Booked_Loans, SUM(IS_GAP_ELIGIBLE) AS Eligible, SUM(IS_GAP_GROSS_SOLD) AS Sold, SUM(IS_GAP_CANCELED) AS Canceled, SUM(IS_GAP_NET_SOLD) AS Net_Sold FROM optional_product_master
UNION ALL
SELECT 'AUT' AS Product, COUNT(*) AS Total_Booked_Loans, SUM(IS_AUT_ELIGIBLE) AS Eligible, SUM(IS_AUT_GROSS_SOLD) AS Sold, SUM(IS_AUT_CANCELED) AS Canceled, SUM(IS_AUT_NET_SOLD) AS Net_Sold FROM optional_product_master
UNION ALL
SELECT 'HA'  AS Product, COUNT(*) AS Total_Booked_Loans, SUM(IS_HA_ELIGIBLE)  AS Eligible, SUM(IS_HA_GROSS_SOLD)  AS Sold, SUM(IS_HA_CANCELED)  AS Canceled, SUM(IS_HA_NET_SOLD)  AS Net_Sold FROM optional_product_master
UNION ALL
SELECT 'ATL' AS Product, COUNT(*) AS Total_Booked_Loans, SUM(IS_ATL_ELIGIBLE) AS Eligible, SUM(IS_ATL_GROSS_SOLD) AS Sold, SUM(IS_ATL_CANCELED) AS Canceled, SUM(IS_ATL_NET_SOLD) AS Net_Sold FROM optional_product_master
UNION ALL
SELECT 'SSG' AS Product, COUNT(*) AS Total_Booked_Loans, SUM(IS_SSG_ELIGIBLE) AS Eligible, SUM(IS_SSG_GROSS_SOLD) AS Sold, SUM(IS_SSG_CANCELED) AS Canceled, SUM(IS_SSG_NET_SOLD) AS Net_Sold FROM optional_product_master
UNION ALL
SELECT 'DIP' AS Product, COUNT(*) AS Total_Booked_Loans, SUM(IS_DIP_ELIGIBLE) AS Eligible, SUM(IS_DIP_GROSS_SOLD) AS Sold, SUM(IS_DIP_CANCELED) AS Canceled, SUM(IS_DIP_NET_SOLD) AS Net_Sold FROM optional_product_master;
