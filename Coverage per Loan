SELECT 
    DATE_TRUNC('MONTH', cpl_date) AS reporting_month,
    cust_type,
    channel_group,
    
    SUM(cpl_loans) AS total_loans,
    SUM(sold) - SUM(cancel) AS net_written,

    -- Net CPL
    CAST(SUM(sold) - SUM(cancel) AS FLOAT) 
        / NULLIF(SUM(cpl_loans), 0) AS net_cpl

FROM OP_GOVERNANCE_YJY
WHERE reporting_status IN ('Included', 'Loan Denominator')
  AND cpl_date >= '2025-01-01'
         AND CHANNEL_GROUP <> 'Other'
GROUP BY 1, 2, 3
ORDER BY 1 ASC, 3;
